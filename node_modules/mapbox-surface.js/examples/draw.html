<!DOCTYPE html>
<html>

<head>
    <title>mapbox-surface.js</title>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1'>
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.0/mapbox.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.0/mapbox.css' rel='stylesheet' />
    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.css' rel='stylesheet' />
    <script src='../dist/mapbox.surface.min.js'></script>
    <link rel='stylesheet' href='../dist/mapbox.surface.css' />
    <style>
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        height: 100%;
        width: 100%;
    }
    body {
        margin: 0;
        padding: 0;
    }
    </style>
</head>

<body>
    <div id='map'></div>
</body>

<script>
L.mapbox.accessToken = 'pk.eyJ1IjoiYm9iYnlzdWQiLCJhIjoiZlY0VElqTSJ9.gGJetUgdQKj64oeS5j9kzQ';

var map = L.mapbox.map('map', 'bobbysud.iia43k9m')
    .setView([34.58884537801345, -119.52266693115234], 13);

var surface = L.mapbox.surface({
    mapid: 'mapbox.mapbox-terrain-v1',
    layer: 'contour',
    fields: 'ele',
});
var featureGroup = L.featureGroup().addTo(map);
var markerLayer = L.featureGroup().addTo(map);

var drawControl = new L.Control.Draw({
    edit: {
        featureGroup: featureGroup
    },
    draw: {
        circle: false,
        polygon: false,
        marker: false,
        rectangle: false
    }
}).addTo(map);

// Set surface options
var surfaceOptions = {
    mapid: 'mapbox.mapbox-terrain-v1',
    layer: 'contour',
    fields: 'ele',
};

map.on('draw:created', function(e) {
    var allData = [];

    featureGroup.clearLayers();
    markerLayer.clearLayers();

    featureGroup.addLayer(e.layer);
    var data = e.layer.getLatLngs();

    data.forEach(function(point){
        allData.push([point.lat, point.lng]);
    });

    surface.getData(surfaceOptions, allData, function(error, res) {
        if (error) throw new Error(error);

        var elevationChart = L.mapbox.surface.chart({
                position: 'topright',
                chartType: 'area',
                yAxis: {
                    data: 'ele',
                    label: 'Elevation (m)',
                    numberOfTicks: 4
                },
                margin: [40, 18, 25, 48],
                height: 100,
                width: 350
            }, res)
            .addTo(map);

        L.mapbox.surface.line({
            chart: elevationChart,
            color: 'orange',
            weight: 10
        }, res).addTo(map);
    });

});
</script>
</html>
